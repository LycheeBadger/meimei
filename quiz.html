<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        .quiz-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            width: 600px;
            max-width: 90%;
        }
        .question {
            font-size: 1.2em;
            margin-bottom: 20px;
        }
        .options label {
            display: block;
            margin: 10px 0;
        }
        .options input[type="radio"], .options input[type="checkbox"] {
            margin-right: 10px;
        }
        button {
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }
        button:hover {
            background-color: #0056b3;
        }
        #result {
            margin-top: 20px;
            font-size: 1em;
        }
        #progress {
            margin-bottom: 20px;
            font-size: 0.9em;
        }
        #language-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #language-toggle:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>
    <button id="language-toggle">Switch to Chinese</button>
    <div class="quiz-container">
        <div id="progress"></div>
        <div id="word"></div>
        <div id="question" class="question"></div>
        <div id="options" class="options"></div>
        <button id="submit">Submit</button>
        <div id="result"></div>
    </div>

    <script>
        let questions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let isChinese = false;

        // Get database name from query parameter
        const urlParams = new URLSearchParams(window.location.search);
        const dbName = urlParams.get('db') || 'social1'; // Default to 'social1' if no db specified
        const jsonFile = `data/${dbName}.json`;

        // Load JSON data
        async function loadQuestions() {
            try {
                const response = await fetch(jsonFile);
                if (!response.ok) throw new Error('Failed to load quiz data');
                questions = await response.json();
                displayQuestion();
            } catch (error) {
                console.error(error);
                document.getElementById('question').innerText = 'Error loading quiz data.';
            }
        }

        // Display current question
        function displayQuestion() {
            const q = questions[currentQuestionIndex];
            const questionText = isChinese ? q.questionZh : q.question;
            const wordText = isChinese ? q.wordZh : q.word;

            document.getElementById('progress').innerText = `Question ${currentQuestionIndex + 1} of ${questions.length}`;
            document.getElementById('word').innerText = `Word: ${wordText}`;
            document.getElementById('question').innerText = questionText;
            const optionsDiv = document.getElementById('options');
            optionsDiv.innerHTML = '';

            if (q.type === 'multiple-choice') {
                q.options.forEach((option, index) => {
                    const label = document.createElement('label');
                    label.innerHTML = `
                        <input type="radio" name="option" value="${option}">
                        ${isChinese ? q.optionsZh[index] : option}
                    `;
                    optionsDiv.appendChild(label);
                });
            } else if (q.type === 'true-false') {
                q.options.forEach((option, index) => {
                    const label = document.createElement('label');
                    label.innerHTML = `
                        <input type="radio" name="option" value="${option}">
                        ${isChinese ? q.optionsZh[index] : option}
                    `;
                    optionsDiv.appendChild(label);
                });
            } else if (q.type === 'select-all') {
                q.options.forEach((option, index) => {
                    const label = document.createElement('label');
                    label.innerHTML = `
                        <input type="checkbox" name="option" value="${index + 1}">
                        ${isChinese ? q.optionsZh[index] : option}
                    `;
                    optionsDiv.appendChild(label);
                });
            }

            document.getElementById('result').innerText = '';
        }

        // Check answer
        function checkAnswer() {
            const q = questions[currentQuestionIndex];
            let selectedOptions = [];

            if (q.type === 'multiple-choice' || q.type === 'true-false') {
                const selected = document.querySelector('input[name="option"]:checked');
                if (!selected) {
                    document.getElementById('result').innerText = isChinese ? '请选择一个答案！' : 'Please select an answer!';
                    return;
                }
                selectedOptions = [selected.value];
            } else if (q.type === 'select-all') {
                selectedOptions = Array.from(document.querySelectorAll('input[name="option"]:checked'))
                    .map(input => input.value);
                if (selectedOptions.length === 0) {
                    document.getElementById('result').innerText = isChinese ? '请至少选择一个答案！' : 'Please select at least one answer!';
                    return;
                }
            }

            let isCorrect = false;
            if (q.type === 'multiple-choice' || q.type === 'true-false') {
                isCorrect = selectedOptions[0] === q.correct;
            } else if (q.type === 'select-all') {
                isCorrect = selectedOptions.length === q.correct.length &&
                            selectedOptions.every(val => q.correct.includes(val)) &&
                            q.correct.every(val => selectedOptions.includes(val));
            }

            const resultDiv = document.getElementById('result');
            if (isCorrect) {
                score++;
                resultDiv.innerText = isChinese ? '正确！' : 'Correct!';
                resultDiv.style.color = 'green';
            } else {
                const correctAnswer = q.type === 'select-all'
                    ? (isChinese ? q.correctZh.join(', ') : q.correct.map(i => q.options[i - 1]).join(', '))
                    : (isChinese ? q.correctZh : q.correct);
                resultDiv.innerText = isChinese
                    ? `错误。正确答案是：${correctAnswer}\n例句：${q.exampleZh}`
                    : `Incorrect. The correct answer is: ${correctAnswer}\nExample: ${q.example}`;
                resultDiv.style.color = 'red';
            }

            setTimeout(() => {
                currentQuestionIndex++;
                if (currentQuestionIndex < questions.length) {
                    displayQuestion();
                } else {
                    document.getElementById('question').innerText = isChinese ? '测验完成！' : 'Quiz completed!';
                    document.getElementById('options').innerHTML = '';
                    document.getElementById('submit').style.display = 'none';
                    resultDiv.innerText = isChinese
                        ? `你的得分是 ${score} / ${questions.length}`
                        : `Your score is ${score} / ${questions.length}`;
                    resultDiv.style.color = 'black';
                }
            }, 1000);
        }

        // Toggle language
        document.getElementById('language-toggle').addEventListener('click', () => {
            isChinese = !isChinese;
            document.getElementById('language-toggle').innerText = isChinese ? '切换到英文' : 'Switch to Chinese';
            displayQuestion();
        });

        // Submit answer
        document.getElementById('submit').addEventListener('click', checkAnswer);

        // Load questions on page load
        loadQuestions();
    </script>
</body>
</html>
